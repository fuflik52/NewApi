<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <style>
    :root {
      --bg-color: #000000;
      --text-color: #ffffff;
      --accent-color: #ffffff;
      --secondary-bg: rgba(255, 255, 255, 0.05);
      --border-color: rgba(255, 255, 255, 0.15);
      --input-bg: rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      font-size: 12px;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .page {
      display: none;
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-out;
      padding-bottom: 80px; /* Space for bottom nav */
    }

    .page.active {
      display: block;
    }

    /* Headers */
    h2 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-color);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
    }

    /* Horizontal Selectors (Radio Groups) */
    .selector-group {
      margin-bottom: 20px;
    }

    .selector-label {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 8px;
      text-transform: uppercase;
      font-weight: 600;
    }

    .horizontal-options {
      display: flex;
      background: var(--secondary-bg);
      border-radius: 8px;
      padding: 4px;
      gap: 4px;
    }

    .option-label {
      flex: 1;
      text-align: center;
      padding: 8px 4px;
      cursor: pointer;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s ease;
      color: rgba(255, 255, 255, 0.6);
      position: relative;
    }

    .option-label:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
    }

    .option-input {
      display: none;
    }

    .option-input:checked + span {
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .option-content {
        display: block;
        width: 100%;
        height: 100%;
        padding: 8px 4px;
        border-radius: 6px;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: #fff;
      color: #000;
      border: none;
    }
    
    .btn-primary:hover {
      background: #f0f0f0;
    }

    /* Textarea */
    .code-area {
      position: relative;
      margin-top: 16px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: #111;
      overflow: hidden;
    }
    
    textarea {
      width: 100%;
      height: 200px;
      background: transparent;
      border: none;
      color: #aaa;
      font-family: 'Consolas', monospace;
      font-size: 11px;
      padding: 12px;
      resize: none;
      outline: none;
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      border: 1px solid transparent;
    }

    .copy-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Settings Inputs */
    .input-group {
      margin-bottom: 16px;
    }

    .input-label {
      display: block;
      font-size: 11px;
      color: rgba(255,255,255,0.6);
      margin-bottom: 6px;
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: #fff;
      font-family: monospace;
      outline: none;
    }

    input:focus {
      border-color: rgba(255,255,255,0.4);
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border-color);
      display: flex;
      padding: 12px;
      gap: 8px;
      z-index: 100;
    }

    .nav-btn {
      flex: 1;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.5);
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      background: rgba(255,255,255,0.05);
      color: #fff;
    }

    .nav-btn.active {
      background: rgba(255,255,255,0.15);
      color: #fff;
    }
    
    /* Log Window */
    .log-container {
        margin-top: 20px;
        padding: 10px;
        background: rgba(0,0,0,0.3);
        border-radius: 6px;
        border: 1px solid var(--border-color);
        font-family: monospace;
        font-size: 10px;
        color: #888;
        max-height: 100px;
        overflow-y: auto;
    }

    .log-entry { margin-bottom: 4px; }
    .log-entry.error { color: #ff6b6b; }
    .log-entry.success { color: #51cf66; }

  </style>
</head>

<body>

  <!-- PAGE 1: GENERATION -->
  <div id="page-generation" class="page active">
    
    <!-- Asset Mode -->
    <div class="selector-group">
      <div class="selector-label">Режим ассетов:</div>
      <div class="horizontal-options">
        <label class="option-label">
          <input type="radio" name="asset-mode" value="urls" checked class="option-input">
          <span class="option-content">Ссылки (URL)</span>
        </label>
        <label class="option-label">
          <input type="radio" name="asset-mode" value="data" class="option-input">
          <span class="option-content">Data (локальные файлы)</span>
        </label>
      </div>
    </div>

    <!-- Generation Mode -->
    <div class="selector-group">
      <div class="selector-label">Режим генерации:</div>
      <div class="horizontal-options">
        <label class="option-label">
          <input type="radio" name="anchor-mode" value="corners" checked class="option-input">
          <span class="option-content">По углам (адаптивно)</span>
        </label>
        <label class="option-label">
          <input type="radio" name="anchor-mode" value="center" class="option-input">
          <span class="option-content">От центра (центрировано)</span>
        </label>
      </div>
    </div>

    <button class="btn btn-primary" id="generate-btn" onclick="generateCode()">
        ГЕНЕРИРОВАТЬ C# КОД
    </button>
    
    <div class="log-container" id="log-window">
        <div class="log-entry">Готов к работе...</div>
    </div>

    <div class="code-area" id="code-output" style="display:none;">
       <button class="copy-btn" onclick="copyCode()">COPY</button>
       <textarea id="csharp-code" readonly></textarea>
    </div>

  </div>

  <!-- PAGE 2: EXTRA -->
  <div id="page-extra" class="page">
    <h2>Дополнительные функции</h2>
    
    <button class="btn" onclick="textToUppercase()">
      ВЕСЬ ТЕКСТ В CAPS
    </button>

    <button class="btn" onclick="alignTextToRectangles()">
      ТЕКСТ ПО РАЗМЕРУ ФОНА
    </button>

    <button class="btn" onclick="alignTextHeights()">
      ВЫРОВНЯТЬ ТЕКСТЫ ПО ВЫСОТЕ
    </button>
    
    <div style="margin-top: 20px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
        <div style="font-size: 10px; color: #888; margin-bottom: 5px;">Статус API</div>
        <div id="api-status" style="color: #fff;">Не проверялось</div>
    </div>
  </div>

  <!-- PAGE 3: SETTINGS -->
  <div id="page-settings" class="page">
    <h2>Настройки</h2>

    <div class="input-group">
      <label class="input-label">API КЛЮЧ (BublickRust)</label>
      <input type="password" id="api-token" placeholder="sk_live_..." onchange="saveToken()">
    </div>

    <div class="input-group">
        <label class="input-label">ТЕМА ОФОРМЛЕНИЯ</label>
        <div class="horizontal-options">
            <label class="option-label">
              <input type="radio" name="theme" value="dark" checked class="option-input">
              <span class="option-content">Dark</span>
            </label>
            <label class="option-label">
              <input type="radio" name="theme" value="light" class="option-input">
              <span class="option-content">Light (Soon)</span>
            </label>
        </div>
    </div>
    
    <div style="margin-top: 40px; text-align: center; opacity: 0.3; font-size: 10px;">
        v2.0.0 Redesign
    </div>
  </div>

  <!-- BOTTOM NAVIGATION -->
  <div class="bottom-nav">
    <button class="nav-btn active" onclick="switchPage('generation', this)">Генерация</button>
    <button class="nav-btn" onclick="switchPage('extra', this)">Дополнительно</button>
    <button class="nav-btn" onclick="switchPage('settings', this)">Настройки</button>
  </div>

  <script>
    // --- UI LOGIC ---
    let currentCode = '';

    function switchPage(pageId, btn) {
        // Hide all pages
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        // Show selected page
        document.getElementById('page-' + pageId).classList.add('active');
        
        // Update nav buttons
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    function log(msg, type='info') {
        const win = document.getElementById('log-window');
        const div = document.createElement('div');
        div.className = 'log-entry ' + type;
        div.textContent = '> ' + msg;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    // --- ACTIONS ---

    function generateCode() {
        const token = document.getElementById('api-token').value;
        const assetMode = document.querySelector('input[name="asset-mode"]:checked').value;
        const anchorMode = document.querySelector('input[name="anchor-mode"]:checked').value;

        if (assetMode === 'urls' && !token) {
            log('Ошибка: Введите API токен в настройках!', 'error');
            switchPage('settings', document.querySelectorAll('.nav-btn')[2]);
            return;
        }

        log('Запуск генерации...', 'info');
        document.getElementById('generate-btn').textContent = 'ГЕНЕРАЦИЯ...';
        document.getElementById('generate-btn').disabled = true;
        document.getElementById('code-output').style.display = 'none';

        parent.postMessage({ 
            pluginMessage: { 
                type: 'generate-code', 
                apiToken: token,
                assetMode: assetMode,
                anchorMode: anchorMode
            } 
        }, '*');
    }

    function textToUppercase() {
        parent.postMessage({ pluginMessage: { type: 'text-to-uppercase' } }, '*');
    }

    function alignTextToRectangles() {
        parent.postMessage({ pluginMessage: { type: 'align-text-to-rectangles' } }, '*');
    }

    function alignTextHeights() {
        parent.postMessage({ pluginMessage: { type: 'align-text-heights' } }, '*');
    }

    function saveToken() {
        const token = document.getElementById('api-token').value;
        parent.postMessage({ pluginMessage: { type: 'save-token', apiToken: token } }, '*');
    }

    function copyCode() {
        const el = document.getElementById('csharp-code');
        el.select();
        document.execCommand('copy');
        log('Код скопирован в буфер!', 'success');
    }

    // --- MESSAGES FROM PLUGIN ---
    window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        
        if (msg.type === 'init') {
            if (msg.token) {
                document.getElementById('api-token').value = msg.token;
                log('Токен загружен', 'success');
            }
        }
        else if (msg.type === 'log') {
            log(msg.message);
        }
        else if (msg.type === 'error') {
            log(msg.message, 'error');
            resetBtn();
        }
        else if (msg.type === 'code-generated') {
            currentCode = msg.csharp;
            document.getElementById('csharp-code').value = currentCode;
            document.getElementById('code-output').style.display = 'block';
            log('Код успешно сгенерирован!', 'success');
            resetBtn();
        }
        else if (msg.type === 'token-saved') {
            log('Токен сохранен', 'success');
        }
    };

    function resetBtn() {
        const btn = document.getElementById('generate-btn');
        btn.textContent = 'ГЕНЕРИРОВАТЬ C# КОД';
        btn.disabled = false;
    }

    // Init
    document.addEventListener('DOMContentLoaded', () => {
        parent.postMessage({ pluginMessage: { type: 'request-init' } }, '*');
    });

  </script>
</body>
</html>